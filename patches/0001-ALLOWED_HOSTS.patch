From a92f01d8127de517056146ce388f19a2d007f8af Mon Sep 17 00:00:00 2001
From: George Garside <apps@georgegarside.com>
Date: Sun, 15 Feb 2026 15:36:58 +0000
Subject: [PATCH] ALLOWED_HOSTS

---
 app/Http/Kernel.php                  |  2 ++
 app/Http/Middleware/AllowedHosts.php | 20 ++++++++++++++++++++
 2 files changed, 22 insertions(+)
 create mode 100644 app/Http/Middleware/AllowedHosts.php

diff --git a/app/Http/Kernel.php b/app/Http/Kernel.php
index 3b002cf5a2..c00f769fb8 100644
--- a/app/Http/Kernel.php
+++ b/app/Http/Kernel.php
@@ -23,6 +23,7 @@

 namespace FireflyIII\Http;

+use FireflyIII\Http\Middleware\AllowedHosts;
 use FireflyIII\Http\Middleware\Authenticate;
 use FireflyIII\Http\Middleware\Binder;
 use FireflyIII\Http\Middleware\InstallationId;
@@ -45,6 +46,7 @@
 class Kernel extends HttpKernel
 {
     protected $middleware         = [
+        AllowedHosts::class,
         // SecureHeaders::class,
         CheckForMaintenanceMode::class,
         ValidatePostSize::class,
diff --git a/app/Http/Middleware/AllowedHosts.php b/app/Http/Middleware/AllowedHosts.php
new file mode 100644
index 0000000000..27685d4d9a
--- /dev/null
+++ b/app/Http/Middleware/AllowedHosts.php
@@ -0,0 +1,20 @@
+<?php
+
+namespace FireflyIII\Http\Middleware;
+
+use Closure;
+use Illuminate\Http\Request;
+
+class AllowedHosts {
+    public function handle(Request $request, Closure $next) {
+        $allowedHosts = explode(',', env('ALLOWED_HOSTS', ''));
+        if (empty($allowedHosts)) {
+            return $next($request);
+        }
+        if (!in_array($request->header('Host'), $allowedHosts)) {
+            app('log')->warning('Host not in ALLOWED_HOSTS: ' . $request->header('Host'));
+            abort(403);
+        }
+        return $next($request);
+    }
+}
--
2.52.0
